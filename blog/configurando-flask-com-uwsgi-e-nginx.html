<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8">
    <title>Configurando Flask com UWSGI e Nginx</title>
    <meta name="description" content="Configurando flask com UWSGI e NGINX">

    <meta name="theme-color"           content="#48CBAB">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"              content="width=device-width, initial-scale=1">

    <meta property="og:url"            content="http://vitorleal.com">
    <meta property="og:image"          content="http://vitorleal.com/assets/img/vitorleal.jpg">
    <meta property="og:title"          content="Configurando Flask com UWSGI e Nginx">
    <meta property="og:description"    content="Configurando flask com UWSGI e NGINX">
    <meta property="og:type"           content="blog">

    <meta name="twitter:card"          content="summary">
    <meta name="twitter:creator"       content="@vitorleal">
    <meta name="twitter:site"          content="@vitorleal">
    <meta name="twitter:domain"        content="http://vitorleal.com">
    <meta name="twitter:title"         content="Configurando Flask com UWSGI e Nginx">
    <meta name="twitter:description"   content="Configurando flask com UWSGI e NGINX">
    <meta property="og:image"          content="http://vitorleal.com/assets/img/vitorleal.jpg">

    <link href="../assets/img/favicon.png"    rel="icon">
    <link href="../assets/img/favicon.big.png" rel="icon" sizes="192x192">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="../assets/css/prism.css">
    <link rel="stylesheet" href="../assets/css/material.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-5427757-17', 'auto');
  ga('send', 'pageview');
</script>

  </head>

  <body>
    <section class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
      <div class="android-header mdl-layout__header mdl-layout__header--waterfall">
  <div class="mdl-layout__header-row">
    <h1 class="android-font android-title mdl-layout-title mdl-typography--text-uppercase android-link">Vitor Leal</h1>

    <div class="android-header-spacer mdl-layout-spacer"></div>

    <div class="android-navigation-container">
      <nav class="android-navigation mdl-navigation">
        
        <a class="mdl-navigation__link mdl-typography--text-uppercase
          "
          href="../">
          Home
        </a>
        
        <a class="mdl-navigation__link mdl-typography--text-uppercase
          active"
          href="../blog">
          Blog
        </a>
        
        <a class="mdl-navigation__link mdl-typography--text-uppercase
          "
          href="../projetos">
          Projetos
        </a>
        
        <a class="mdl-navigation__link mdl-typography--text-uppercase
          "
          href="../portfolio">
          Portfolio
        </a>
        
        <a class="mdl-navigation__link mdl-typography--text-uppercase
          "
          href="../talks">
          Talks
        </a>
        
      </nav>
    </div>
  </div>
</div>

<div class="android-drawer mdl-layout__drawer">
  <nav class="mdl-navigation">
    
    <a class="mdl-navigation__link" href="../">
      Home
    </a>
    
    <a class="mdl-navigation__link" href="../blog">
      Blog
    </a>
    
    <a class="mdl-navigation__link" href="../projetos">
      Projetos
    </a>
    
    <a class="mdl-navigation__link" href="../portfolio">
      Portfolio
    </a>
    
    <a class="mdl-navigation__link" href="../talks">
      Talks
    </a>
    
    
    <a class="mdl-navigation__link" href="https://github.com/vitorleal" target="_blank">
      GitHub
    </a>
    
    <a class="mdl-navigation__link" href="http://www.linkedin.com/in/vitorleal" target="_blank">
      LinkedIn
    </a>
    
    <a class="mdl-navigation__link" href="https://twitter.com/@vitorleal" target="_blank">
      Twitter
    </a>
    
  </nav>
</div>


      <div class="android-content mdl-layout__content">
        
          <a name="top"></a>




<section style="background-image: url(/assets/img/blog/flask-uwsgi-nginx.jpg)" class="blog-post-section"></section>


<h2 class="android-font blog-post-title mdl-typography--text-center">Configurando Flask com UWSGI e Nginx</h2>

<section class="android-blog-section android-post-section">
  <header>
    <p class="meta date">
      <time datetime="2014-08-05 016:00" pubdate="">
        
        5/8/2014
      </time>
    </p>
  </header>

  <p>Neste post vou mostrar como configurar os serviços <a href="https://github.com/unbit/uwsgi-docs">UWSGI</a> e <a href="http://nginx.com">Nginx</a> em um servidor Ubuntu
 para rodar aplicações web utilizando o microframework de Python chamdo <a href="http://flask.pocoo.org">Flask</a>.</p>
<h2>O que é <a href="http://flask.pocoo.org">Flask</a></h2><p>O Flask é um microframework para desenvolvimento web criado em Python. Super leve e compacto mas bem robusto e desenvolvido com ferramentas
 bem estáveis como a linguagem de templates para Python <a href="http://jinja.pocoo.org/docs">Jinja 2</a> e da biblioteca de <a href="http://en.wikipedia.org/wiki/Web_Server_Gateway_Interface">WSGI</a>
 para Ptyhon chamada <a href="http://werkzeug.pocoo.org">Werkzeug</a>.</p>
<h2>Instalando o Nginx e o UWSGI no servidor</h2><p>Para instalar o Ngin e o UWSGI vamos utilizar o <strong>apt-get</strong>.</p>
<pre><code class="language-bash">$ apt-get install uwsgi uwsgi-plugin-python nginx
</code></pre>
<h2>Configurando o UWSGI</h2><p>Primeiro vamos crair o arquivo de configuração do <strong>uwsgi</strong> do nosso nosso webapp.</p>
<pre><code class="language-bash">$ touch /etc/uwsgi/apps-available/nosso-app.ini
</code></pre>
<p>Criamos um link simbólico do nosso arquvio de configuração na pasta <strong>etc/uwsgi/apps-enabled/</strong>.</p>
<pre><code class="language-bash">$ ln -s /etc/uwsgi/apps-available/nosso-app.ini /etc/uwsgi/apps-enabled/nosso-app.ini
</code></pre>
<p>Criamos o arquivo <strong>.sock</strong></p>
<pre><code class="language-bash">$ touch /tmp/nosso-app.sock
</code></pre>
<p>Agora vamos inserir os dados de configuração do nosso app.</p>
<pre><code class="language-bash">[uwsgi]
vhost      = true
master     = true
socket     = /tmp/nosso-app.sock    #local do socket do nosso app
mod-socket = 666
venv       = /var/www/nosso-app/ENV #caminho do VirtualEnv nosso app
chdir      = /var/www/nosso-app     #caminho dos arquivod do nosso app
module     = run_server             #arquivo que roda nosso app flask
callable   = app
processes  = 4
threads    = 2
http       = 0.0.0.0:5000           #ip e porta que vai rodar o app
plugins    = python                 #plugin python do uwsgi que instalamos
env        = ENV_VARIABLE=variable  #variaveis de ambiente
</code></pre>
<p>Já podemos reiniciar o nosso serviço <strong>uwsgi</strong></p>
<pre><code class="language-bash">$ sudo service uwsgi restart
</code></pre>
<h2>Configurando o Nginx</h2><p>Primeiro vamos crair o arquivo de configuração <strong>nginx</strong> do nosso webapp.</p>
<pre><code class="language-bash">$ touch /etc/nginx/sites-available/nosso-app
</code></pre>
<p>Criamos um link simbólico do nosso arquvio de configuração na pasta <strong>/etc/nginx/sites-enabled/</strong>.</p>
<pre><code class="language-bash">$ ln -s /etc/nginx/sites-available/nosso-app /etc/nginx/sites-enabled/nosso-app
</code></pre>
<p>Agora vamos inserir as configuração do nginx</p>
<pre><code class="language-bash">server {
     listen 80; #roda na porta 80
     client_max_body_size 10m; #maximo upload de 10m

     location / {
         include            uwsgi_params;             #parametros do uwsgi
         uwsgi_pass         unix:/tmp/nosso-app.sock; #nosso arquivo sock
         proxy_redirect     off;
         proxy_set_header   Host $host;
         proxy_set_header   X-Real-IP $remote_addr;
         proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
         proxy_set_header   X-Forwarded-Host $server_name;
     }

     location /static {
         #servir os arquivos estáticos
         alias /var/www/nosso-app/static;

         #habilitar o gzip nos arquivos estáticos
         gzip              on;
         gzip_static       on;
         gzip_comp_level   9;
         gzip_min_length   1400;
         gzip_types        text/plain text/css image/png image/gif
                           image/jpeg application/x-javascript text/xml
                           application/xml application/xml+rss text/javascript;
         gzip_vary         on;
         gzip_http_version 1.1;
         gzip_disable      &quot;MSIE [1-6]\.(?!.*SV1)&quot;;
     }
}
</code></pre>
<p>Agora podemos reiniciar o serviço <strong>nginx</strong></p>
<pre><code class="language-bash">$ sudo service nginx restart
</code></pre>
<h2>Conclusão</h2><p>Agora você pode acessar o ip ou dominio do seu servidor para ver o seu webapp rodando.</p>

  

  <h3>Deixe seu comentário</h3>
<article id="disqus_thread"></article>

<script>
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//vitorleal.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

</section>


        

        <footer class="android-footer mdl-mega-footer">
  <div class="mdl-mega-footer--top-section">
    <div class="mdl-mega-footer--left-section">
    </div>

    <div class="mdl-mega-footer--right-section">
      <a class="mdl-typography--font-light" href="#top">
        Ir para o topo <i class="material-icons">expand_less</i>
      </a>
    </div>
  </div>

  <div class="mdl-mega-footer--middle-section">
    <p class="mdl-typography--font-light">
      Copyright &copy; 2015 - Vitor Leal - <a href="mailto:me@vitorleal.com">me@vitorleal.com</a>
    </p>
  </div>

  <div class="mdl-mega-footer--bottom-section">
    
    <a class="android-link mdl-typography--font-light"
      href="../">
      Home
    </a>
    
    <a class="android-link mdl-typography--font-light"
      href="../blog">
      Blog
    </a>
    
    <a class="android-link mdl-typography--font-light"
      href="../projetos">
      Projetos
    </a>
    
    <a class="android-link mdl-typography--font-light"
      href="../portfolio">
      Portfolio
    </a>
    
    <a class="android-link mdl-typography--font-light"
      href="../talks">
      Talks
    </a>
    
    
    <a class="android-link mdl-typography--font-light" href="https://github.com/vitorleal" target="_blank">
      GitHub
    </a>
    
    <a class="android-link mdl-typography--font-light" href="http://www.linkedin.com/in/vitorleal" target="_blank">
      LinkedIn
    </a>
    
    <a class="android-link mdl-typography--font-light" href="https://twitter.com/@vitorleal" target="_blank">
      Twitter
    </a>
    
  </div>
</footer>

      </div>
    </section>

    <script src="../assets/js/material.min.js" ></script>
    <script src="../assets/js/prism.js"></script>
  </body>
</html>
