<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8">
    <title>Configurando Flask com UWSGI e Nginx</title>
    <meta name="author"              content="Vitor Leal">
    <meta name="description"         content="Consultor de Sistemas e Negócios no Centro de Inovação da Telefonica VIVO trabalhando com Internet of Things e Smart Cities.">

    <meta name="viewport"            content="width=device-width, initial-scale=1">
    <meta property="og:url"          content="http://vitorleal.com">
    <meta property="og:image"        content="http://vitorleal.com/assets/img/vitorleal.jpg">
    <meta property="og:title"        content="Configurando Flask com UWSGI e Nginx">
    <meta property="og:description"  content="Consultor de Sistemas e Negócios no Centro de Inovação da Telefonica VIVO trabalhando com Internet of Things e Smart Cities.">
    <meta property="og:type"         content="blog">

    <meta name="twitter:card"        content="summary">
    <meta name="twitter:creator"     content="@vitorleal">
    <meta name="twitter:site"        content="@vitorleal">
    <meta name="twitter:domain"      content="http://vitorleal.com">
    <meta name="twitter:title"       content="Configurando Flask com UWSGI e Nginx">
    <meta name="twitter:description" content="Consultor de Sistemas e Negócios no Centro de Inovação da Telefonica VIVO trabalhando com Internet of Things e Smart Cities.">
    <meta property="og:image"        content="http://vitorleal.com/assets/img/vitorleal.jpg">

    <link href="../assets/img/favicon.png"                                        rel="icon">
    <link href="http://fonts.googleapis.com/css?family=Quattrocento+Sans|Roboto:400,300"  rel="stylesheet">
    <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css" rel="stylesheet">
    <link href="../assets/css/main.css"                                           rel="stylesheet">

    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script src="../assets/js/main.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-5427757-17', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <section class="container">
      <aside class="left">
  <div class="inner-left">
    <header>
  <img src="../assets/img/vitorleal.jpg" alt="Vitor Leal" title="Vitor Leal" class="profilepic" />

  <hgroup>
    <h1>
      <a href="/">Vitor Leal</a>
    </h1>
    <h2 class="subtitle">Full-Stack Developer</h2>
  </hgroup>
</header>


    <ul class="main-navigation">
  
  <li>
    <a class="btn btn-dark " href="../blog">Blog</a>
  </li>
  
  <li>
    <a class="btn btn-dark " href="../projetos">Projetos</a>
  </li>
  
  <li>
    <a class="btn btn-dark " href="../talks">Talks</a>
  </li>
  
</ul>

<fieldset class="mobile-nav">
  <select>
    <option value="">Menu…</option>
    
    <option value="../blog">» Blog</option>
    
    <option value="../projetos">» Projetos</option>
    
    <option value="../talks">» Talks</option>
    
  </select>
</fieldset>


    <footer>
  <p>
    
    <a href="http://github.com/vitorleal" class="btn btn-dark">GitHub</a>
    

    
    <a href="http://www.linkedin.com/in/vitorleal" class="btn btn-dark">LinkedIn</a>
    
  </p>
</footer>

  </div>
</aside>


      <article class="right">
        <div class="inner-right">
          
          

<header>
  <h1 class="entry-title">Configurando Flask com UWSGI e Nginx</h1>
  <p class="meta">
  <time datetime="2014-08-05 016:00" pubdate="undefined">
      
      5/8/2014
    </time>
  </p>
</header>

<p><img src="http://vitorleal.com/assets/img/blog/flask-uwsgi-nginx.jpg" alt="Configurando Flask no servidor" title="Configurando Flask com UWSGI e Nginx"></p>
<p>Neste post vou mostrar como configurar os serviços <a href="https://github.com/unbit/uwsgi-docs">UWSGI</a> e <a href="http://nginx.com">Nginx</a> em um servidor Ubuntu
 para rodar aplicações web utilizando o microframework de Python chamdo <a href="http://flask.pocoo.org">Flask</a>.</p>
<h2>O que é <a href="http://flask.pocoo.org">Flask</a></h2><p>O Flask é um microframework para desenvolvimento web criado em Python. Super leve e compacto mas bem robusto e desenvolvido com ferramentas
 bem estáveis como a linguagem de templates para Python <a href="http://jinja.pocoo.org/docs">Jinja 2</a> e da biblioteca de <a href="http://en.wikipedia.org/wiki/Web_Server_Gateway_Interface">WSGI</a>
 para Ptyhon chamada <a href="http://werkzeug.pocoo.org">Werkzeug</a>.</p>
<hr>
<h2>Instalando o Nginx e o UWSGI no servidor</h2><p>Para instalar o Ngin e o UWSGI vamos utilizar o <strong>apt-get</strong>.</p>
<pre><code>$ apt-get install uwsgi uwsgi-plugin-python nginx
</code></pre><hr>
<h2>Configurando o UWSGI</h2><p>Primeiro vamos crair o arquivo de configuração do <strong>uwsgi</strong> do nosso nosso webapp.</p>
<pre><code>$ touch /etc/uwsgi/apps-available/nosso-app.ini
</code></pre><p>Criamos um link simbólico do nosso arquvio de configuração na pasta <em>/etc/uwsgi/apps-enabled/*</em>.</p>
<pre><code>$ ln -s /etc/uwsgi/apps-available/nosso-app.ini /etc/uwsgi/apps-enabled/nosso-app.ini
</code></pre><p>Criamos o arquivo <strong>.sock</strong></p>
<pre><code>$ touch /tmp/nosso-app.sock
</code></pre><p>Agora vamos inserir os dados de configuração do nosso app.</p>
<pre><code>[uwsgi]
vhost      = true
master     = true
socket     = /tmp/nosso-app.sock    #local do socket do nosso app
mod-socket = 666
venv       = /var/www/nosso-app/ENV #caminho do VirtualEnv nosso app
chdir      = /var/www/nosso-app     #caminho dos arquivod do nosso app
module     = run_server             #arquivo que roda nosso app flask
callable   = app
processes  = 4
threads    = 2
http       = 0.0.0.0:5000           #ip e porta que vai rodar o app
plugins    = python                 #plugin python do uwsgi que instalamos
env        = ENV_VARIABLE=variable  #variaveis de ambiente
</code></pre><p>Já podemos reiniciar o nosso serviço <strong>uwsgi</strong></p>
<pre><code>$ sudo service uwsgi restart
</code></pre><hr>
<h2>Configurando o Nginx</h2><p>Primeiro vamos crair o arquivo de configuração <strong>nginx</strong> do nosso webapp.</p>
<pre><code>$ touch /etc/nginx/sites-available/nosso-app
</code></pre><p>Criamos um link simbólico do nosso arquvio de configuração na pasta <em>/etc/nginx/sites-enabled/*</em>.</p>
<pre><code>$ ln -s /etc/nginx/sites-available/nosso-app /etc/nginx/sites-enabled/nosso-app
</code></pre><p>Agora vamos inserir as configuração do nginx</p>
<pre><code>server {
     listen 80; #roda na porta 80
     client_max_body_size 10m; #maximo upload de 10m

     location / {
         include            uwsgi_params;             #parametros do uwsgi
         uwsgi_pass         unix:/tmp/nosso-app.sock; #nosso arquivo sock
         proxy_redirect     off;
         proxy_set_header   Host $host;
         proxy_set_header   X-Real-IP $remote_addr;
         proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
         proxy_set_header   X-Forwarded-Host $server_name;
     }

     location /static {
         #servir os arquivos estáticos
         alias /var/www/nosso-app/static;

         #habilitar o gzip nos arquivos estáticos
         gzip              on;
         gzip_static       on;
         gzip_comp_level   9;
         gzip_min_length   1400;
         gzip_types        text/plain text/css image/png image/gif
                           image/jpeg application/x-javascript text/xml
                           application/xml application/xml+rss text/javascript;
         gzip_vary         on;
         gzip_http_version 1.1;
         gzip_disable      &quot;MSIE [1-6]\.(?!.*SV1)&quot;;
     }
}
</code></pre><p>Agora podemos reiniciar o serviço <strong>nginx</strong></p>
<pre><code>$ sudo service nginx restart
</code></pre><h2>Conclusão</h2><p>Agora você pode acessar o ip ou dominio do seu servidor para ver o seu webapp rodando.</p>



<h3>Deixe seu comentário</h3>
<article id="disqus_thread"></article>

<script>
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//vitorleal.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>



          

          <footer id="footer">
  <p class="credit">Copyright &copy; 2015 - Vitor Leal</p>
</footer>

        </div>
      </article>
    </section>
  </body>
</html>
